<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE Map [
<!ENTITY % entities SYSTEM "entities.xml.inc">
%entities;
]>
<!--
version 2012-10-27 - Yves Cainaud
-->
<Map xmlns:xi="http://www.w3.org/2001/XInclude"
srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over"
background-color="transparent"
font-directory="fonts\" >
    <Style name="nodes-nordic">
        <Rule>
            &maxscale_zoom0;
            &minscale_zoom8;
            <MarkersSymbolizer fill="orange" opacity="0.5"
            width="1.5" height="1.5" stroke="orange"
            stroke-width="3" stroke-opacity=".2"
            placement="point" marker-type="ellipse"
            allow-overlap="true" spacing="0"/>
        </Rule>
    </Style>
    <Style name="nodes-nordic2" comp-op="color-dodge">
        <Rule>
            &maxscale_zoom0;
            &minscale_zoom8;
            <MarkersSymbolizer fill="orange" opacity="1"
            width="0.5" height="0.5" stroke="orange"
            stroke-width="2" stroke-opacity="0.6"
            placement="point" marker-type="ellipse"
            allow-overlap="true" spacing="0"/>
        </Rule>
    </Style>


    <Style name="nodes-downhill">
        <Rule>
            &maxscale_zoom0;
            &minscale_zoom8;
            <MarkersSymbolizer fill="#1E70FF" opacity="0.5"
            width="1.5" height="1.5" stroke="#1E70FF"
            stroke-width="3" stroke-opacity=".2"
            placement="point" marker-type="ellipse"
            allow-overlap="true" spacing="0"/>
        </Rule>
    </Style>
    <Style name="nodes-downhill2" comp-op="color-dodge">
        <Rule>
            &maxscale_zoom0;
            &minscale_zoom8;

            <MarkersSymbolizer fill="#1E70FF" opacity="1"
            width="0.5" height="0.5" stroke="#1E70FF"
            stroke-width="2" stroke-opacity="0.6"
            placement="point" marker-type="ellipse"
            allow-overlap="true" spacing="0"/>
        </Rule>
    </Style>

    &downhill;
    &downhillus;
    &snowshoeing;
    &aerialways;
    &skitour;
    &others;
    
<!-- White casing -->
    <Style name="nordic-bg">
        <Rule>
            &maxscale_zoom9;
            &minscale_zoom11;
            <LineSymbolizer stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
             stroke="#FFFFFF"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            &maxscale_zoom11;
            &minscale_zoom12;
            <LineSymbolizer stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
             stroke="#FFFFFF"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            &maxscale_zoom12;
            &minscale_zoom14;
            <LineSymbolizer stroke-width="5" stroke-linecap="round" stroke-linejoin="round"
             stroke="#FFFFFF"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            &maxscale_zoom14;
            &minscale_zoom18;
            <LineSymbolizer stroke-width="7" stroke-linecap="round" stroke-linejoin="round"
             stroke="#FFFFFF"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
    </Style>

<!-- Ways -->
    <Style name="nordic">
        <Rule>
            &maxscale_zoom9;
            &minscale_zoom11;
            <LineSymbolizer stroke="#44b2a3" stroke-width="1" stroke-linecap="round"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            <Filter>[piste:grooming]='classic' or [piste:grooming]='skating' or [piste:grooming]='classic;skating'  or [piste:grooming]='classic+skating'</Filter>
            &maxscale_zoom11;
            &minscale_zoom12;
            <LineSymbolizer stroke="#44b2a3" stroke-width="2" stroke-linecap="round"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            <Filter>[piste:grooming]='classic' or [piste:grooming]='skating' or [piste:grooming]='classic;skating'  or [piste:grooming]='classic+skating'</Filter>
            &maxscale_zoom12;
            &minscale_zoom14;
            <LineSymbolizer stroke="#44b2a3" stroke-width="3" stroke-linecap="round"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            &maxscale_zoom14;
            &minscale_zoom18;
            <Filter>[piste:grooming]='classic' or [piste:grooming]='skating' or [piste:grooming]='classic;skating'  or [piste:grooming]='classic+skating'</Filter>
            <LineSymbolizer stroke="#44b2a3" stroke-width="4" stroke-linecap="round"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            <ElseFilter />
            &maxscale_zoom11;
            &minscale_zoom12;
            <LineSymbolizer stroke="#44b2a3" stroke-width="1" stroke-linecap="round" stroke-dasharray="3,3"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            <ElseFilter />
            &maxscale_zoom12;
            &minscale_zoom14;
            <LineSymbolizer stroke="#44b2a3" stroke-width="2" stroke-linecap="round" stroke-dasharray="5,5"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            <ElseFilter />
            &maxscale_zoom14;
            &minscale_zoom18;
            <LineSymbolizer stroke="#44b2a3" stroke-width="3" stroke-linecap="round" stroke-dasharray="8,8"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
    </Style>

<!--eraser to remove way below relations-->
    <Style name="eraser" comp-op="dst-out">
        <Rule>
            &maxscale_zoom9;
            &minscale_zoom12;
            <LineSymbolizer stroke-width="3" stroke-linecap="round" stroke-linejoin="round"
             stroke="#FFFFFF"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            &maxscale_zoom12;
            &minscale_zoom14;
            <LineSymbolizer stroke-width="5" stroke-linecap="round" stroke-linejoin="round"
             stroke="#FFFFFF"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            &maxscale_zoom14;
            &minscale_zoom18;
            <LineSymbolizer stroke-width="7" stroke-linecap="round" stroke-linejoin="round"
             stroke="#FFFFFF"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
    </Style>
<!--eraser to remove way below semi-transparent areas-->
<Style name="area-eraser" comp-op="dst-out">
	<Rule>
		&maxscale_zoom9;
		&minscale_zoom18;
		<PolygonSymbolizer fill="#FFFFFF"  gamma=".6"/>
	</Rule>
	<Rule>
		&maxscale_zoom11;
		&minscale_zoom12;
		<LineSymbolizer stroke-width="3" stroke="#FFFFFF" 
		stroke-linejoin="round" stroke-linecap="round"  stroke-gamma=".6"/>
	</Rule>
	<Rule>
		&maxscale_zoom13;
		&minscale_zoom15;
		<LineSymbolizer stroke-width="5" stroke="#FFFFFF" 
		stroke-linejoin="round" stroke-linecap="round"  stroke-gamma=".6"/>
	</Rule>
	<Rule>
		&maxscale_zoom15;
		&minscale_zoom18;
		<LineSymbolizer stroke-width="7" stroke="#FFFFFF" 
		stroke-linejoin="round" stroke-linecap="round"  stroke-gamma=".6"/>
	</Rule>
</Style>
<!-- White casing for relations -->
<!-- Colored and offset work for relations -->
    &relations;

<!-- Difficulty overlay -->
    <Style name="difficulty" image-filters="agg-stack-blur(3,3)" comp-op="grain-merge">
        <Rule>
            &maxscale_zoom14;
            &minscale_zoom18;
            <Filter>[piste:difficulty]='intermediate'</Filter>
            <LineSymbolizer stroke="#ffffff" stroke-width="3"
            stroke-linejoin="round" stroke-linecap="round" stroke-opacity="0.6"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
        <Rule>
            &maxscale_zoom14;
            &minscale_zoom18;
            <Filter>[piste:difficulty]='advanced' or [piste:difficulty]='expert' or [piste:difficulty]='freeride' or [piste:difficulty]='extreme' </Filter>
            <LineSymbolizer stroke="#ffffff" stroke-width="3"
            stroke-linejoin="round" stroke-linecap="round" stroke-opacity="0.6"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
    </Style>

<!-- Difficulty overlay eraser image-filters="agg-stack-blur(1,1)" -->
    <Style name="no-difficulty"  comp-op="dst-out">
        <Rule>
            &maxscale_zoom14;
            &minscale_zoom18;
            <LineSymbolizer stroke="#ffffff" stroke-width="15"
            stroke-linejoin="round" stroke-linecap="butt" stroke-opacity="0.3" stroke-dasharray="8,16"  smooth="0.5" stroke-gamma=".6"/>
        </Rule>
    </Style>

<!-- Difficulty overlay -->
    <Style name="difficulty-icons">
        <Rule>
            &maxscale_zoom14;
            &minscale_zoom18;
            <Filter>[piste:difficulty]='intermediate'</Filter>
            <ShieldSymbolizer file="pics/danger-black.svg" fontset-name="DejaVu Sans Bold"
            spacing="200" allow-overlap="false"
            placement="line" transform="scale(0.4,0.4)">' '</ShieldSymbolizer>
        </Rule>
        <Rule>
            &maxscale_zoom14;
            &minscale_zoom18;
            <Filter>[piste:difficulty]='advanced' or [piste:difficulty]='expert' or [piste:difficulty]='freeride' or [piste:difficulty]='extreme' </Filter>
            <ShieldSymbolizer file="pics/danger-red.svg" fontset-name="DejaVu Sans Bold"
            spacing="200" allow-overlap="true"
            placement="line" transform="scale(0.4,0.4)">' '</ShieldSymbolizer>
        </Rule>
    </Style>

<!--text style for sites names-->
    &sites;

    <Layer name="nodes-downhill"
    srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>nodes-downhill</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <Parameter name="table">
            (select ST_StartPoint(way) as way from planet_osm_line where "piste:type"='downhill'
            ) as nodes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="nodes-downhill2"
    srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>nodes-downhill2</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <Parameter name="table">
            (select ST_StartPoint(way) as way from planet_osm_line where "piste:type"='downhill'
            ) as nodes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="nodes-nordic"
    srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>nodes-nordic</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <!-- Select only the first node of each way, don't forget the 'as way' otherwise mapnik can't select points -->
            <Parameter name="table">
            (select ST_StartPoint(way) as way from planet_osm_line where "piste:type"='nordic'
			) as nodes
            </Parameter>
        </Datasource>
    </Layer>

<!-- Overlay layer for color-dodge effect -->
    <Layer name="nodes-nordic2"
    srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>nodes-nordic2</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <!-- Select only the first node of each way, don't forget the 'as way' otherwise mapnik can't select points -->
            <Parameter name="table">
            (select ST_StartPoint(way) as way from planet_osm_line where "piste:type"='nordic'
            ) as nodes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="downhill-casing" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-casing</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='downhill'
            and (ST_X(ST_centroid(way)) &gt; -4000000 or ST_y(ST_centroid(way)) &lt; 0)
            order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-area-casing" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-area-casing</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_polygon where 
            "piste:type"='downhill' and "area"='yes' 
            and (ST_X(ST_centroid(way)) &gt; -4000000 or ST_y(ST_centroid(way)) &lt; 0)
            ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-us-casing" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-us-casing</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='downhill' 
            and (ST_X(ST_centroid(way)) &lt; -4000000 and ST_y(ST_centroid(way)) &gt; 0)
            order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-us-area-casing" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-us-area-casing</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_polygon where 
            "piste:type"='downhill' and "area"='yes' 
            and (ST_X(ST_centroid(way)) &lt; -4000000 and ST_y(ST_centroid(way)) &gt; 0)
            ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-overlay" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-overlay</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='downhill'
            and (ST_X(ST_centroid(way)) &gt; -4000000 or ST_y(ST_centroid(way)) &lt; 0)
            order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-us-overlay" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-us-overlay</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='downhill'
            and (ST_X(ST_centroid(way)) &lt; -4000000 and ST_y(ST_centroid(way)) &gt; 0)
            order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="area-eraser" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>area-eraser</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_polygon where 
            "piste:type"='downhill' and "area"='yes' 
            ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-area-border" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-area-border</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_polygon where 
            "piste:type"='downhill' and "area"='yes' 
            and (ST_X(ST_centroid(way)) &gt; -4000000 or ST_y(ST_centroid(way)) &lt; 0)
            ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-us-area-border" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-us-area-border</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_polygon where
            "piste:type"='downhill' and "area"='yes' 
            and (ST_X(ST_centroid(way)) &lt; -4000000 and ST_y(ST_centroid(way)) &gt; 0)
            order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-overlay-thin" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-overlay-thin</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='downhill'
            and (ST_X(ST_centroid(way)) &gt; -4000000 or ST_y(ST_centroid(way)) &lt; 0)
            order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-us-overlay-thin" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-us-overlay-thin</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='downhill'
            and (ST_X(ST_centroid(way)) &lt; -4000000 and ST_y(ST_centroid(way)) &gt; 0)
            order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="downhill-area-fill" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-area-fill</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_polygon where 
            "piste:type"='downhill' and "area"='yes' 
            and (ST_X(ST_centroid(way)) &gt; -4000000 or ST_y(ST_centroid(way)) &lt; 0)
            ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-us-area-fill" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-us-area-fill</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_polygon where 
            "piste:type"='downhill' and "area"='yes' 
            and (ST_X(ST_centroid(way)) &lt; -4000000 and ST_y(ST_centroid(way)) &gt; 0)
            ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    
    <Layer name="diamonds" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>diamonds</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where 
            "piste:type"='downhill'
            and (ST_X(ST_centroid(way)) &lt; -4000000 and ST_y(ST_centroid(way)) &gt; 0)
            ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="diamonds-area" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>diamonds-area</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_polygon where 
            "piste:type"='downhill' and "area"='yes' 
            and (ST_X(ST_centroid(way)) &lt; -4000000 and ST_y(ST_centroid(way)) &gt; 0)
            ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    
    <Layer name="snowshoeing" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>snowshoeing</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='hike'order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="skitour" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>skitour</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='skitour'order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="nordic-bg" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>nordic-bg</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='nordic' and osm_id &gt; 0 order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="nordic" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>nordic</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='nordic' and osm_id &gt; 0 order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="eraser"
    srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>eraser</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='nordic' and osm_id &lt; 0 order by z_order) as routes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="relation-bg"
    srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>relation-bg</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='nordic' and osm_id &lt; 0 order by z_order) as routes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="relation"
    srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>relation</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='nordic' and osm_id &lt; 0 ORDER BY ST_LENGTH(way) ASC) as routes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="difficulty" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>difficulty</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (SELECT * FROM planet_osm_line where "piste:type"='nordic' and osm_id &gt; 0 order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="no-difficulty" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>no-difficulty</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (SELECT * FROM planet_osm_line where "piste:type"='nordic' and ("piste:difficulty" not in ('novice','easy','intermediate','advanced','expert','freeride','extreme') or "piste:difficulty" is null) and osm_id &gt; 0 order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="others" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>others</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line 
                where "piste:type" in ('ice_skate','playground','sled','ski_jump','snow_park')
                or sport in ('skating','ski_jump','ski_jump_take_off') order by z_order
             ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    
    <Layer name="others-area" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>others-area</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_polygon 
                where "piste:type" in ('playground','snow_park')
                order by z_order
             ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
        
    <Layer name="aerialways" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>aerialways</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where "aerialway" is not null or "railway"='funicular' order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="others-icons" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>others-icons</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line 
                where "piste:type" in ('ice_skate','playground','sled','ski_jump','snow_park')
                or sport in ('skating','ski_jump','ski_jump_take_off') order by z_order
             ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="others-icons-area" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>others-icons</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_polygon 
                where "piste:type" in ('ice_skate','playground','sled','ski_jump','snow_park','downhill')
                or sport in ('skating','ski_jump','ski_jump_take_off') order by z_order
             ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    
    <Layer name="aerialways-icons" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>aerialways-icons</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <Parameter name="table">
            (select way as way, aerialway, railway 
            from planet_osm_line 
            where ("aerialway" is not null or "railway"='funicular')
            and degrees(st_azimuth(st_startpoint(way), st_endpoint(way))) &lt; 180
            order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="aerialways-icons-rev" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>aerialways-icons-rev</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <Parameter name="table">
            (select st_reverse(way) as way, aerialway, railway 
            from planet_osm_line 
            where ("aerialway" is not null or "railway"='funicular')
            and degrees(st_azimuth(st_startpoint(way), st_endpoint(way))) &gt; 180
            order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    
    <Layer name="difficulty-icons" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>difficulty-icons</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='nordic' and osm_id &gt; 0 order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="other-icons" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-icons</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select * from planet_osm_line where "piste:difficulty"='freeride' or"piste:grooming"='mogul' or "gladed"='yes' or "lit"='yes' or "piste:lit"='yes' order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="text" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>text</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_line</Parameter>
            <Parameter name="table">
            (select * from planet_osm_line where "piste:type"='nordic' and osm_id &lt; 0 order by z_order) as text
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-text" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-text</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select way, coalesce("piste:name",name) as name, gladed,lit,"piste:difficulty","piste:grooming","piste:lit" 
            from planet_osm_line 
            where "piste:type"='downhill'
            and (ST_X(ST_centroid(way)) &gt; -4000000 or ST_y(ST_centroid(way)) &lt; 0) 
            order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-area-text" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-text</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select way, coalesce("piste:name",name) as name, gladed,lit,"piste:difficulty","piste:grooming","piste:lit" 
            from planet_osm_polygon 
            where "piste:type"='downhill' and "area"='yes' 
            and (ST_X(ST_centroid(way)) &gt; -4000000 or ST_y(ST_centroid(way)) &lt; 0)
            ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-text-us" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-text-us</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select way, coalesce("piste:name",name) as name, gladed,lit,"piste:difficulty","piste:grooming","piste:lit" 
            from planet_osm_line 
            where "piste:type"='downhill'
            and (ST_X(ST_centroid(way)) &lt; -4000000 and ST_y(ST_centroid(way)) &gt; 0) 
            order by z_order) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="downhill-area-text-us" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>downhill-text-us</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select way, coalesce("piste:name",name) as name, gladed,lit,"piste:difficulty","piste:grooming","piste:lit" 
            from planet_osm_polygon where 
            "piste:type"='downhill' and "area"='yes' 
            and (ST_X(ST_centroid(way)) &lt; -4000000 and ST_y(ST_centroid(way)) &gt; 0)
            ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="other-text" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>other-text</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select  way, coalesce("piste:name",name) as name, "piste:type", sport
            from planet_osm_line 
                where "piste:type" in ('ice_skate','playground','sled','ski_jump','snow_park')
                or sport in ('skating','ski_jump','ski_jump_take_off') order by z_order
              ) as pistes
            </Parameter>
        </Datasource>
    </Layer>
    <Layer name="other-area-text" srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>other-text</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="table">
            (select  way, coalesce("piste:name",name) as name, "piste:type", sport
            from planet_osm_polygon
                where "piste:type" in ('ice_skate','playground','sled','ski_jump','snow_park')
                or sport in ('skating','ski_jump','ski_jump_take_off') order by z_order
              ) as pistes
            </Parameter>
        </Datasource>
    </Layer>

    <Layer name="site_text" clear-label-cache="on"
    srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs +over">
        <StyleName>site_text</StyleName>
        <Datasource>
            &datasource-settings;
            <Parameter name="geometry_table">planet_osm_point</Parameter>
            <Parameter name="table">
            (select * from planet_osm_point where site_name is not null) as text
            </Parameter>
        </Datasource>
    </Layer>
</Map>
